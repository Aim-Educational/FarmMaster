import GraphQL from "./graphql.js";
export class PagedTable {
    constructor(tableNodeOrId, query, queryToList) {
        this.query = query;
        this.queryToList = queryToList;
        this.ITEMS_PER_PAGE = 25;
        if (tableNodeOrId instanceof HTMLTableElement)
            this.tableNode = tableNodeOrId;
        else
            this.tableNode = document.getElementById(tableNodeOrId);
        if (!this.tableNode)
            throw "The table node is null. Parameter given was: " + tableNodeOrId;
        this.tbody = (this.tableNode.tBodies.length > 0) ? this.tableNode.tBodies.item(0) : this.tableNode.createTBody();
        this.tfooter = (this.tableNode.tFoot) ? this.tableNode.tFoot : this.tableNode.createTFoot();
        this.pageName = this.tableNode.dataset.graphqlPageCountName;
        this.controller = this.tableNode.dataset.controller;
        this.actionEdit = this.tableNode.dataset.actionEdit;
        this.actionDelete = this.tableNode.dataset.actionDelete;
        const tr = this.tfooter.appendChild(document.createElement("tr"));
        const th = tr.appendChild(document.createElement("th"));
        th.colSpan = 9999;
        this.pageItems = th.appendChild(document.createElement("div"));
        this.pageItems.classList.add("ui", "center", "aligned", "pagination", "menu");
        this.query = query;
        this.refreshPageCount();
        this.setPage(0);
    }
    refreshPageCount() {
        GraphQL.query(`query GetPageCount{
                pageCount {
                    ${this.pageName}
                }
            }`, null)
            .then((data) => {
            while (this.pageItems.firstChild)
                this.pageItems.removeChild(this.pageItems.firstChild);
            for (let i = 0; i < data.pageCount[this.pageName]; i++) {
                const a = this.pageItems.appendChild(document.createElement("a"));
                a.classList.add("item");
                a.innerText = "" + (i + 1);
                a.onclick = () => {
                    this.setPage(i);
                };
            }
        })
            .catch(e => alert("Failed to fetch page: " + e));
    }
    setPage(page) {
        GraphQL
            .query(this.query, { skip: (this.ITEMS_PER_PAGE * page), take: this.ITEMS_PER_PAGE })
            .then(data => {
            while (this.tbody.firstChild)
                this.tbody.removeChild(this.tbody.firstChild);
            const items = this.queryToList(data);
            let i = 0;
            for (const itemRow of items) {
                const tr = this.tbody.appendChild(document.createElement("tr"));
                for (const item of itemRow.items) {
                    const td = tr.appendChild(document.createElement("td"));
                    td.innerText = item;
                }
                const td = tr.appendChild(document.createElement("td"));
                const div = td.appendChild(document.createElement("div"));
                div.classList.add("ui", "two", "buttons");
                const buttonEdit = div.appendChild(document.createElement("a"));
                const divider = div.appendChild(document.createElement("div"));
                const buttonDelete = div.appendChild(document.createElement("a"));
                buttonEdit.classList.add("ui", "inverted", "tiny", "secondary", "left", "button");
                buttonDelete.classList.add("ui", "inverted", "tiny", "secondary", "right", "button");
                divider.classList.add("or", "divider");
                buttonEdit.innerText = "Edit";
                buttonDelete.innerText = "Delete";
                buttonEdit.href = `/${this.controller}/${this.actionEdit}/${itemRow.id}`;
                buttonDelete.href = `/${this.controller}/${this.actionDelete}/${itemRow.id}`;
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9TY3JpcHRzL3RhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sT0FBTyxNQUFNLGNBQWMsQ0FBQztBQUVuQyxNQUFNLE9BQU8sVUFBVTtJQWFuQixZQUNJLGFBQXdDLEVBQ3hCLEtBQWEsRUFDYixXQUE2RDtRQUQ3RCxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsZ0JBQVcsR0FBWCxXQUFXLENBQWtEO1FBZmpFLG1CQUFjLEdBQVcsRUFBRSxDQUFDO1FBaUJ4QyxJQUFJLGFBQWEsWUFBWSxnQkFBZ0I7WUFDekMsSUFBSSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7O1lBRS9CLElBQUksQ0FBQyxTQUFTLEdBQXFCLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFOUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTO1lBQ2YsTUFBTSwrQ0FBK0MsR0FBRyxhQUFhLENBQUM7UUFFMUUsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2xILElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUU1RixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLG9CQUFxQixDQUFDO1FBQzdELElBQUksQ0FBQyxV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QyxDQUFDO2dCQUNsRixZQUFZLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUNyRixPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBRXZDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO2dCQUM5QixZQUFZLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztnQkFFbEMsVUFBVSxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3pFLFlBQVksQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksT0FBTyxDQUFDLEVBQUUsRUFBRSxDQUFDO2FBQ2hGO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR3JhcGhRTCBmcm9tIFwiLi9ncmFwaHFsLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUGFnZWRUYWJsZSB7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgSVRFTVNfUEVSX1BBR0U6IG51bWJlciA9IDI1O1xyXG5cclxuICAgIHB1YmxpYyByZWFkb25seSB0YWJsZU5vZGU6IEhUTUxUYWJsZUVsZW1lbnQ7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgdGJvZHk6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHRmb290ZXI6IEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50O1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHBhZ2VJdGVtczogSFRNTERpdkVsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIHJlYWRvbmx5IHBhZ2VOYW1lOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgY29udHJvbGxlcjogc3RyaW5nO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGFjdGlvbkVkaXQ6IHN0cmluZztcclxuICAgIHB1YmxpYyByZWFkb25seSBhY3Rpb25EZWxldGU6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICB0YWJsZU5vZGVPcklkOiBIVE1MVGFibGVFbGVtZW50IHwgc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBxdWVyeTogc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBxdWVyeVRvTGlzdDogKGRhdGE6IGFueSkgPT4geyBpZDogbnVtYmVyLCBpdGVtczogc3RyaW5nW10gfVtdXHJcbiAgICApIHtcclxuICAgICAgICBpZiAodGFibGVOb2RlT3JJZCBpbnN0YW5jZW9mIEhUTUxUYWJsZUVsZW1lbnQpXHJcbiAgICAgICAgICAgIHRoaXMudGFibGVOb2RlID0gdGFibGVOb2RlT3JJZDtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMudGFibGVOb2RlID0gPEhUTUxUYWJsZUVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVOb2RlT3JJZCk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy50YWJsZU5vZGUpXHJcbiAgICAgICAgICAgIHRocm93IFwiVGhlIHRhYmxlIG5vZGUgaXMgbnVsbC4gUGFyYW1ldGVyIGdpdmVuIHdhczogXCIgKyB0YWJsZU5vZGVPcklkO1xyXG5cclxuICAgICAgICB0aGlzLnRib2R5ID0gKHRoaXMudGFibGVOb2RlLnRCb2RpZXMubGVuZ3RoID4gMCkgPyB0aGlzLnRhYmxlTm9kZS50Qm9kaWVzLml0ZW0oMCkhIDogdGhpcy50YWJsZU5vZGUuY3JlYXRlVEJvZHkoKTtcclxuICAgICAgICB0aGlzLnRmb290ZXIgPSAodGhpcy50YWJsZU5vZGUudEZvb3QpID8gdGhpcy50YWJsZU5vZGUudEZvb3QgOiB0aGlzLnRhYmxlTm9kZS5jcmVhdGVURm9vdCgpO1xyXG5cclxuICAgICAgICB0aGlzLnBhZ2VOYW1lID0gdGhpcy50YWJsZU5vZGUuZGF0YXNldC5ncmFwaHFsUGFnZUNvdW50TmFtZSE7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gdGhpcy50YWJsZU5vZGUuZGF0YXNldC5jb250cm9sbGVyITtcclxuICAgICAgICB0aGlzLmFjdGlvbkVkaXQgPSB0aGlzLnRhYmxlTm9kZS5kYXRhc2V0LmFjdGlvbkVkaXQhO1xyXG4gICAgICAgIHRoaXMuYWN0aW9uRGVsZXRlID0gdGhpcy50YWJsZU5vZGUuZGF0YXNldC5hY3Rpb25EZWxldGUhO1xyXG5cclxuICAgICAgICBjb25zdCB0ciA9IHRoaXMudGZvb3Rlci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIikpO1xyXG4gICAgICAgIGNvbnN0IHRoID0gdHIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpKTtcclxuICAgICAgICB0aC5jb2xTcGFuID0gOTk5OTtcclxuICAgICAgICB0aGlzLnBhZ2VJdGVtcyA9IHRoLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpO1xyXG4gICAgICAgIHRoaXMucGFnZUl0ZW1zLmNsYXNzTGlzdC5hZGQoXCJ1aVwiLCBcImNlbnRlclwiLCBcImFsaWduZWRcIiwgXCJwYWdpbmF0aW9uXCIsIFwibWVudVwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5O1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFBhZ2VDb3VudCgpO1xyXG4gICAgICAgIHRoaXMuc2V0UGFnZSgwKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVmcmVzaFBhZ2VDb3VudCgpIHtcclxuICAgICAgICBHcmFwaFFMLnF1ZXJ5KFxyXG4gICAgICAgICAgICBgcXVlcnkgR2V0UGFnZUNvdW50e1xyXG4gICAgICAgICAgICAgICAgcGFnZUNvdW50IHtcclxuICAgICAgICAgICAgICAgICAgICAke3RoaXMucGFnZU5hbWV9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1gLCBudWxsKVxyXG4gICAgICAgICAgICAudGhlbigoZGF0YTogeyBwYWdlQ291bnQ6IGFueSB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5wYWdlSXRlbXMuZmlyc3RDaGlsZClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2VJdGVtcy5yZW1vdmVDaGlsZCh0aGlzLnBhZ2VJdGVtcy5maXJzdENoaWxkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEucGFnZUNvdW50W3RoaXMucGFnZU5hbWVdOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gdGhpcy5wYWdlSXRlbXMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuY2xhc3NMaXN0LmFkZChcIml0ZW1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5pbm5lclRleHQgPSBcIlwiICsgKGkgKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBhLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFnZShpKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZSA9PiBhbGVydChcIkZhaWxlZCB0byBmZXRjaCBwYWdlOiBcIiArIGUpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0UGFnZShwYWdlOiBudW1iZXIpIHtcclxuICAgICAgICBHcmFwaFFMXHJcbiAgICAgICAgICAgIC5xdWVyeSh0aGlzLnF1ZXJ5LCB7IHNraXA6ICh0aGlzLklURU1TX1BFUl9QQUdFICogcGFnZSksIHRha2U6IHRoaXMuSVRFTVNfUEVSX1BBR0UgfSlcclxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy50Ym9keS5maXJzdENoaWxkKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGJvZHkucmVtb3ZlQ2hpbGQodGhpcy50Ym9keS5maXJzdENoaWxkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMucXVlcnlUb0xpc3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW1Sb3cgb2YgaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ciA9IHRoaXMudGJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbVJvdy5pdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZCA9IHRyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZCA9IHRyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2ID0gdGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoXCJ1aVwiLCBcInR3b1wiLCBcImJ1dHRvbnNcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbkVkaXQgPSBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdmlkZXIgPSBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uRGVsZXRlID0gZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRWRpdC5jbGFzc0xpc3QuYWRkKFwidWlcIiwgXCJpbnZlcnRlZFwiLCBcInRpbnlcIiwgXCJzZWNvbmRhcnlcIiwgXCJsZWZ0XCIsIFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkRlbGV0ZS5jbGFzc0xpc3QuYWRkKFwidWlcIiwgXCJpbnZlcnRlZFwiLCBcInRpbnlcIiwgXCJzZWNvbmRhcnlcIiwgXCJyaWdodFwiLCBcImJ1dHRvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXZpZGVyLmNsYXNzTGlzdC5hZGQoXCJvclwiLCBcImRpdmlkZXJcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkVkaXQuaW5uZXJUZXh0ID0gXCJFZGl0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRGVsZXRlLmlubmVyVGV4dCA9IFwiRGVsZXRlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkVkaXQuaHJlZiA9IGAvJHt0aGlzLmNvbnRyb2xsZXJ9LyR7dGhpcy5hY3Rpb25FZGl0fS8ke2l0ZW1Sb3cuaWR9YDtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25EZWxldGUuaHJlZiA9IGAvJHt0aGlzLmNvbnRyb2xsZXJ9LyR7dGhpcy5hY3Rpb25EZWxldGV9LyR7aXRlbVJvdy5pZH1gO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==