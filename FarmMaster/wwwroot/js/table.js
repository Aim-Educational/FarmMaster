import GraphQL from "./graphql.js";
export class PagedTable {
    constructor(tableNodeOrId, query, queryToList, configFunc) {
        this.query = query;
        this.queryToList = queryToList;
        this.configFunc = configFunc;
        this.ITEMS_PER_PAGE = 25;
        if (tableNodeOrId instanceof HTMLTableElement)
            this.tableNode = tableNodeOrId;
        else
            this.tableNode = document.getElementById(tableNodeOrId);
        if (!this.tableNode)
            throw "The table node is null. Parameter given was: " + tableNodeOrId;
        this.tbody = (this.tableNode.tBodies.length > 0) ? this.tableNode.tBodies.item(0) : this.tableNode.createTBody();
        this.tfooter = (this.tableNode.tFoot) ? this.tableNode.tFoot : this.tableNode.createTFoot();
        this.pageName = this.tableNode.dataset.graphqlPageCountName;
        this.controller = this.tableNode.dataset.controller;
        this.actionEdit = this.tableNode.dataset.actionEdit;
        this.actionDelete = this.tableNode.dataset.actionDelete;
        const tr = this.tfooter.appendChild(document.createElement("tr"));
        const th = tr.appendChild(document.createElement("th"));
        th.colSpan = 9999;
        this.pageItems = th.appendChild(document.createElement("div"));
        this.pageItems.classList.add("ui", "center", "aligned", "pagination", "menu");
        // Param names are just short hand versions of the ones in the typings for configFunc above.
        configFunc = configFunc ? configFunc : (id, c, ae, ad, be, bd) => {
            be.href = `/${c}/${ae}/${id}`;
            bd.href = `/${c}/${ad}/${id}`;
        };
        this.query = query;
        this.refreshPageCount();
        this.setPage(0);
    }
    refreshPageCount() {
        GraphQL.query(`query GetPageCount{
                pageCount {
                    ${this.pageName}
                }
            }`, null)
            .then((data) => {
            while (this.pageItems.firstChild)
                this.pageItems.removeChild(this.pageItems.firstChild);
            for (let i = 0; i < data.pageCount[this.pageName]; i++) {
                const a = this.pageItems.appendChild(document.createElement("a"));
                a.classList.add("item");
                a.innerText = "" + (i + 1);
                a.onclick = () => {
                    this.setPage(i);
                };
            }
        })
            .catch(e => alert("Failed to fetch page: " + JSON.stringify(e)));
    }
    setPage(page) {
        GraphQL
            .query(this.query, { skip: (this.ITEMS_PER_PAGE * page), take: this.ITEMS_PER_PAGE })
            .then(data => {
            while (this.tbody.firstChild)
                this.tbody.removeChild(this.tbody.firstChild);
            const items = this.queryToList(data);
            let i = 0;
            for (const itemRow of items) {
                const tr = this.tbody.appendChild(document.createElement("tr"));
                for (const item of itemRow.items) {
                    const td = tr.appendChild(document.createElement("td"));
                    td.innerText = item;
                }
                const td = tr.appendChild(document.createElement("td"));
                const div = td.appendChild(document.createElement("div"));
                div.classList.add("ui", "two", "buttons");
                const buttonEdit = div.appendChild(document.createElement("a"));
                const divider = div.appendChild(document.createElement("div"));
                const buttonDelete = div.appendChild(document.createElement("a"));
                buttonEdit.classList.add("ui", "inverted", "tiny", "secondary", "left", "button");
                buttonDelete.classList.add("ui", "inverted", "tiny", "secondary", "right", "button");
                divider.classList.add("or", "divider");
                buttonEdit.innerText = "Edit";
                buttonDelete.innerText = "Delete";
                this.configFunc(itemRow.id, this.controller, this.actionEdit, this.actionDelete, buttonEdit, buttonDelete);
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9TY3JpcHRzL3RhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sT0FBTyxNQUFNLGNBQWMsQ0FBQztBQUVuQyxNQUFNLE9BQU8sVUFBVTtJQWFuQixZQUNJLGFBQXdDLEVBQ3hCLEtBQWEsRUFDYixXQUE2RCxFQUM3RCxVQUMyRztRQUgzRyxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsZ0JBQVcsR0FBWCxXQUFXLENBQWtEO1FBQzdELGVBQVUsR0FBVixVQUFVLENBQ2lHO1FBakIvRyxtQkFBYyxHQUFXLEVBQUUsQ0FBQztRQW1CeEMsSUFBSSxhQUFhLFlBQVksZ0JBQWdCO1lBQ3pDLElBQUksQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDOztZQUUvQixJQUFJLENBQUMsU0FBUyxHQUFxQixRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRTlFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUztZQUNmLE1BQU0sK0NBQStDLEdBQUcsYUFBYSxDQUFDO1FBRTFFLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsSCxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFNUYsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFD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Q0FBQyxDQUFDO2dCQUUxQyxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDaEUsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQy9ELE1BQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUVsRSxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUNsRixZQUFZLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUNyRixPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBRXZDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO2dCQUM5QixZQUFZLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztnQkFFbEMsSUFBSSxDQUFDLFVBQVcsQ0FDWixPQUFPLENBQUMsRUFBRSxFQUNWLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsWUFBWSxFQUNqQixVQUFVLEVBQ1YsWUFBWSxDQUNmLENBQUM7YUFDTDtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEdyYXBoUUwgZnJvbSBcIi4vZ3JhcGhxbC5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBhZ2VkVGFibGUge1xyXG4gICAgcHVibGljIHJlYWRvbmx5IElURU1TX1BFUl9QQUdFOiBudW1iZXIgPSAyNTtcclxuXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgdGFibGVOb2RlOiBIVE1MVGFibGVFbGVtZW50O1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHRib2R5OiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHB1YmxpYyByZWFkb25seSB0Zm9vdGVyOiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDtcclxuICAgIHB1YmxpYyByZWFkb25seSBwYWdlSXRlbXM6IEhUTUxEaXZFbGVtZW50O1xyXG5cclxuICAgIHB1YmxpYyByZWFkb25seSBwYWdlTmFtZTogc3RyaW5nO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGNvbnRyb2xsZXI6IHN0cmluZztcclxuICAgIHB1YmxpYyByZWFkb25seSBhY3Rpb25FZGl0OiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgYWN0aW9uRGVsZXRlOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgdGFibGVOb2RlT3JJZDogSFRNTFRhYmxlRWxlbWVudCB8IHN0cmluZyxcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgcXVlcnk6IHN0cmluZyxcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgcXVlcnlUb0xpc3Q6IChkYXRhOiBhbnkpID0+IHsgaWQ6IG51bWJlciwgaXRlbXM6IHN0cmluZ1tdIH1bXSxcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgY29uZmlnRnVuYz86IChpZDogbnVtYmVyLCAgICAgICAgICAgY29udHJvbGxlcjogc3RyaW5nLCAgICAgICAgICAgIGFjdGlvbkVkaXQ6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EZWxldGU6IHN0cmluZywgYnV0dG9uRWRpdDogSFRNTEFuY2hvckVsZW1lbnQsIGJ1dHRvbkRlbGV0ZTogSFRNTEFuY2hvckVsZW1lbnQpID0+IHZvaWRcclxuICAgICkge1xyXG4gICAgICAgIGlmICh0YWJsZU5vZGVPcklkIGluc3RhbmNlb2YgSFRNTFRhYmxlRWxlbWVudClcclxuICAgICAgICAgICAgdGhpcy50YWJsZU5vZGUgPSB0YWJsZU5vZGVPcklkO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy50YWJsZU5vZGUgPSA8SFRNTFRhYmxlRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJsZU5vZGVPcklkKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnRhYmxlTm9kZSlcclxuICAgICAgICAgICAgdGhyb3cgXCJUaGUgdGFibGUgbm9kZSBpcyBudWxsLiBQYXJhbWV0ZXIgZ2l2ZW4gd2FzOiBcIiArIHRhYmxlTm9kZU9ySWQ7XHJcblxyXG4gICAgICAgIHRoaXMudGJvZHkgPSAodGhpcy50YWJsZU5vZGUudEJvZGllcy5sZW5ndGggPiAwKSA/IHRoaXMudGFibGVOb2RlLnRCb2RpZXMuaXRlbSgwKSEgOiB0aGlzLnRhYmxlTm9kZS5jcmVhdGVUQm9keSgpO1xyXG4gICAgICAgIHRoaXMudGZvb3RlciA9ICh0aGlzLnRhYmxlTm9kZS50Rm9vdCkgPyB0aGlzLnRhYmxlTm9kZS50Rm9vdCA6IHRoaXMudGFibGVOb2RlLmNyZWF0ZVRGb290KCk7XHJcblxyXG4gICAgICAgIHRoaXMucGFnZU5hbWUgPSB0aGlzLnRhYmxlTm9kZS5kYXRhc2V0LmdyYXBocWxQYWdlQ291bnROYW1lITtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSB0aGlzLnRhYmxlTm9kZS5kYXRhc2V0LmNvbnRyb2xsZXIhO1xyXG4gICAgICAgIHRoaXMuYWN0aW9uRWRpdCA9IHRoaXMudGFibGVOb2RlLmRhdGFzZXQuYWN0aW9uRWRpdCE7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25EZWxldGUgPSB0aGlzLnRhYmxlTm9kZS5kYXRhc2V0LmFjdGlvbkRlbGV0ZSE7XHJcblxyXG4gICAgICAgIGNvbnN0IHRyID0gdGhpcy50Zm9vdGVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKSk7XHJcbiAgICAgICAgY29uc3QgdGggPSB0ci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIikpO1xyXG4gICAgICAgIHRoLmNvbFNwYW4gPSA5OTk5O1xyXG4gICAgICAgIHRoaXMucGFnZUl0ZW1zID0gdGguYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7XHJcbiAgICAgICAgdGhpcy5wYWdlSXRlbXMuY2xhc3NMaXN0LmFkZChcInVpXCIsIFwiY2VudGVyXCIsIFwiYWxpZ25lZFwiLCBcInBhZ2luYXRpb25cIiwgXCJtZW51XCIpO1xyXG5cclxuICAgICAgICAvLyBQYXJhbSBuYW1lcyBhcmUganVzdCBzaG9ydCBoYW5kIHZlcnNpb25zIG9mIHRoZSBvbmVzIGluIHRoZSB0eXBpbmdzIGZvciBjb25maWdGdW5jIGFib3ZlLlxyXG4gICAgICAgIGNvbmZpZ0Z1bmMgPSBjb25maWdGdW5jID8gY29uZmlnRnVuYyA6IChpZCwgYywgYWUsIGFkLCBiZSwgYmQpID0+IHtcclxuICAgICAgICAgICAgYmUuaHJlZiA9IGAvJHtjfS8ke2FlfS8ke2lkfWA7XHJcbiAgICAgICAgICAgIGJkLmhyZWYgPSBgLyR7Y30vJHthZH0vJHtpZH1gO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTtcclxuICAgICAgICB0aGlzLnJlZnJlc2hQYWdlQ291bnQoKTtcclxuICAgICAgICB0aGlzLnNldFBhZ2UoMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlZnJlc2hQYWdlQ291bnQoKSB7XHJcbiAgICAgICAgR3JhcGhRTC5xdWVyeShcclxuICAgICAgICAgICAgYHF1ZXJ5IEdldFBhZ2VDb3VudHtcclxuICAgICAgICAgICAgICAgIHBhZ2VDb3VudCB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHt0aGlzLnBhZ2VOYW1lfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9YCwgbnVsbClcclxuICAgICAgICAgICAgLnRoZW4oKGRhdGE6IHsgcGFnZUNvdW50OiBhbnkgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHRoaXMucGFnZUl0ZW1zLmZpcnN0Q2hpbGQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlSXRlbXMucmVtb3ZlQ2hpbGQodGhpcy5wYWdlSXRlbXMuZmlyc3RDaGlsZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnBhZ2VDb3VudFt0aGlzLnBhZ2VOYW1lXTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMucGFnZUl0ZW1zLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBhLmNsYXNzTGlzdC5hZGQoXCJpdGVtXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuaW5uZXJUZXh0ID0gXCJcIiArIChpICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBhZ2UoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGUgPT4gYWxlcnQoXCJGYWlsZWQgdG8gZmV0Y2ggcGFnZTogXCIgKyBKU09OLnN0cmluZ2lmeShlKSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRQYWdlKHBhZ2U6IG51bWJlcikge1xyXG4gICAgICAgIEdyYXBoUUxcclxuICAgICAgICAgICAgLnF1ZXJ5KHRoaXMucXVlcnksIHsgc2tpcDogKHRoaXMuSVRFTVNfUEVSX1BBR0UgKiBwYWdlKSwgdGFrZTogdGhpcy5JVEVNU19QRVJfUEFHRSB9KVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLnRib2R5LmZpcnN0Q2hpbGQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50Ym9keS5yZW1vdmVDaGlsZCh0aGlzLnRib2R5LmZpcnN0Q2hpbGQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5xdWVyeVRvTGlzdChkYXRhKTtcclxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbVJvdyBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGhpcy50Ym9keS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtUm93Lml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gdHIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGQuaW5uZXJUZXh0ID0gaXRlbTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gdHIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXYgPSB0ZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZChcInVpXCIsIFwidHdvXCIsIFwiYnV0dG9uc1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uRWRpdCA9IGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2aWRlciA9IGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBidXR0b25EZWxldGUgPSBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIikpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBidXR0b25FZGl0LmNsYXNzTGlzdC5hZGQoXCJ1aVwiLCBcImludmVydGVkXCIsIFwidGlueVwiLCBcInNlY29uZGFyeVwiLCBcImxlZnRcIiwgXCJidXR0b25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRGVsZXRlLmNsYXNzTGlzdC5hZGQoXCJ1aVwiLCBcImludmVydGVkXCIsIFwidGlueVwiLCBcInNlY29uZGFyeVwiLCBcInJpZ2h0XCIsIFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpdmlkZXIuY2xhc3NMaXN0LmFkZChcIm9yXCIsIFwiZGl2aWRlclwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRWRpdC5pbm5lclRleHQgPSBcIkVkaXRcIjtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25EZWxldGUuaW5uZXJUZXh0ID0gXCJEZWxldGVcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdGdW5jIShcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVJvdy5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbkVkaXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uRGVsZXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25FZGl0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25EZWxldGVcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==