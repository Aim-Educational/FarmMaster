import { getCookie } from "./cookies.js";
export var FarmAjaxMessageType;
(function (FarmAjaxMessageType) {
    FarmAjaxMessageType[FarmAjaxMessageType["None"] = 0] = "None";
    FarmAjaxMessageType[FarmAjaxMessageType["Information"] = 1] = "Information";
    FarmAjaxMessageType[FarmAjaxMessageType["Warning"] = 2] = "Warning";
    FarmAjaxMessageType[FarmAjaxMessageType["Error"] = 3] = "Error";
})(FarmAjaxMessageType || (FarmAjaxMessageType = {}));
export var FarmAjaxMessageFormat;
(function (FarmAjaxMessageFormat) {
    FarmAjaxMessageFormat[FarmAjaxMessageFormat["Default"] = 0] = "Default";
    FarmAjaxMessageFormat[FarmAjaxMessageFormat["UnorderedList"] = 1] = "UnorderedList";
})(FarmAjaxMessageFormat || (FarmAjaxMessageFormat = {}));
export class FarmAjaxMessageResponse {
    constructor(type, message, format) {
        this.messageType = type;
        this.message = message;
        this.messageFormat = format;
    }
    populateMessageBox(box) {
        box.classList.remove("info", "error", "warning");
        switch (this.messageType) {
            case FarmAjaxMessageType.Error:
                box.classList.add("error");
                break;
            case FarmAjaxMessageType.Information:
                box.classList.add("info");
                break;
            case FarmAjaxMessageType.Warning:
                box.classList.add("warning");
                break;
            default: break;
        }
        box.classList.add("visible");
        switch (this.messageFormat) {
            case FarmAjaxMessageFormat.Default:
                box.innerHTML = this.message;
                break;
            case FarmAjaxMessageFormat.UnorderedList:
                box.innerHTML = "";
                let ul = document.createElement("ul");
                box.appendChild(ul);
                for (let item of this.message.split("\n")) {
                    let li = document.createElement("li");
                    li.innerText = item;
                    ul.appendChild(li);
                }
                break;
            default: break;
        }
    }
}
export class FarmAjaxMessageAndValueResponse extends FarmAjaxMessageResponse {
    constructor(message, value) {
        super(message.messageType, message.message, message.messageFormat);
        this.value = value;
    }
}
export class FarmAjaxGenericValue {
    constructor(value) {
        this.value = value;
    }
}
export class FarmAjax {
    static postWithMessageResponse(url, data, onDone) {
        FarmAjax
            .doAjax(url, data)
            .done(function (response) {
            onDone(new FarmAjaxMessageResponse(response.messageType, response.message, response.messageFormat));
        })
            .fail((error) => onDone(new FarmAjaxMessageResponse(FarmAjaxMessageType.Error, JSON.stringify(error), FarmAjaxMessageFormat.UnorderedList)));
    }
    static postWithMessageAndValueResponse(url, data, onDone) {
        FarmAjax
            .doAjax(url, data)
            .done(function (response) {
            let message = new FarmAjaxMessageResponse(response.messageType, response.message, response.messageFormat);
            onDone(new FarmAjaxMessageAndValueResponse(message, response.value));
        })
            .fail((error) => {
            let message = new FarmAjaxMessageResponse(FarmAjaxMessageType.Error, JSON.stringify(error), FarmAjaxMessageFormat.UnorderedList);
            onDone(new FarmAjaxMessageAndValueResponse(message, null));
        });
    }
    static doAjax(url, data) {
        if (data === null)
            data = {};
        if (data.SessionToken !== undefined)
            throw "Please don't define your own 'SessionToken' field, FarmAjax will handle that for you.";
        data.SessionToken = getCookie("FarmMasterAuth");
        return $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data),
            headers: {
                "RequestVerificationToken": window.RequestVerificationToken
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFybV9hamF4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vU2NyaXB0cy9mYXJtX2FqYXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQU14QyxNQUFNLENBQU4sSUFBWSxtQkFLWDtBQUxELFdBQVksbUJBQW1CO0lBQzNCLDZEQUFJLENBQUE7SUFDSiwyRUFBVyxDQUFBO0lBQ1gsbUVBQU8sQ0FBQTtJQUNQLCtEQUFLLENBQUE7QUFDVCxDQUFDLEVBTFcsbUJBQW1CLEtBQW5CLG1CQUFtQixRQUs5QjtBQUVELE1BQU0sQ0FBTixJQUFZLHFCQUdYO0FBSEQsV0FBWSxxQkFBcUI7SUFDN0IsdUVBQU8sQ0FBQTtJQUNQLG1GQUFhLENBQUE7QUFDakIsQ0FBQyxFQUhXLHFCQUFxQixLQUFyQixxQkFBcUIsUUFHaEM7QUFFRCxNQUFNLE9BQU8sdUJBQXVCO0lBS2hDLFlBQVksSUFBeUIsRUFBRSxPQUFlLEVBQUUsTUFBNkI7UUFDakYsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7SUFDaEMsQ0FBQztJQUVNLGtCQUFrQixDQUFDLEdBQWdCO1FBQ3RDLEdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFakQsUUFBUSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3RCLEtBQUssbUJBQW1CLENBQUMsS0FBSztnQkFDMUIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzNCLE1BQU07WUFFVixLQUFLLG1CQUFtQixDQUFDLFdBQVc7Z0JBQ2hDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMxQixNQUFNO1lBRVYsS0FBSyxtQkFBbUIsQ0FBQyxPQUFPO2dCQUM1QixHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDN0IsTUFBTTtZQUVWLE9BQU8sQ0FBQyxDQUFDLE1BQU07U0FDbEI7UUFFRCxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU3QixRQUFRLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDeEIsS0FBSyxxQkFBcUIsQ0FBQyxPQUFPO2dCQUM5QixHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQzdCLE1BQU07WUFFVixLQUFLLHFCQUFxQixDQUFDLGFBQWE7Z0JBQ3BDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO2dCQUVuQixJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0QyxHQUFHLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUVwQixLQUFLLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN2QyxJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUN0QyxFQUFFLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztvQkFDcEIsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDdEI7Z0JBQ0QsTUFBTTtZQUVWLE9BQU8sQ0FBQyxDQUFDLE1BQU07U0FDbEI7SUFDTCxDQUFDO0NBQ0o7QUFFRCxNQUFNLE9BQU8sK0JBQW1DLFNBQVEsdUJBQXVCO0lBRzNFLFlBQVksT0FBZ0MsRUFBRSxLQUFlO1FBQ3pELEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ25FLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLENBQUM7Q0FDSjtBQUVELE1BQU0sT0FBTyxvQkFBb0I7SUFHN0IsWUFBWSxLQUFRO1FBQ2hCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLENBQUM7Q0FDSjtBQUVELE1BQU0sT0FBTyxRQUFRO0lBQ2pCLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxHQUFXLEVBQUUsSUFBUyxFQUFFLE1BQW1EO1FBQ3RHLFFBQVE7YUFDSCxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQzthQUNqQixJQUFJLENBQUMsVUFBVSxRQUFpQztZQUM3QyxNQUFNLENBQUMsSUFBSSx1QkFBdUIsQ0FDOUIsUUFBUSxDQUFDLFdBQVcsRUFDcEIsUUFBUSxDQUFDLE9BQU8sRUFDaEIsUUFBUSxDQUFDLGFBQWEsQ0FDekIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSx1QkFBdUIsQ0FDL0MsbUJBQW1CLENBQUMsS0FBSyxFQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUNyQixxQkFBcUIsQ0FBQyxhQUFhLENBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ1osQ0FBQztJQUVELE1BQU0sQ0FBQywrQkFBK0IsQ0FBSSxHQUFXLEVBQUUsSUFBUyxFQUFFLE1BQXFFO1FBQ25JLFFBQVE7YUFDSCxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQzthQUNqQixJQUFJLENBQUMsVUFBVSxRQUE0QztZQUN4RCxJQUFJLE9BQU8sR0FBRyxJQUFJLHVCQUF1QixDQUNyQyxRQUFRLENBQUMsV0FBVyxFQUNwQixRQUFRLENBQUMsT0FBTyxFQUNoQixRQUFRLENBQUMsYUFBYSxDQUN6QixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUksK0JBQStCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ1osSUFBSSxPQUFPLEdBQUcsSUFBSSx1QkFBdUIsQ0FDckMsbUJBQW1CLENBQUMsS0FBSyxFQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUNyQixxQkFBcUIsQ0FBQyxhQUFhLENBQ3RDLENBQUM7WUFDRixNQUFNLENBQUMsSUFBSSwrQkFBK0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQVcsRUFBRSxJQUFTO1FBQ3hDLElBQUksSUFBSSxLQUFLLElBQUk7WUFDYixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWQsSUFBSSxJQUFJLENBQUMsWUFBWSxLQUFLLFNBQVM7WUFDL0IsTUFBTSx1RkFBdUYsQ0FBQztRQUVsRyxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNWLElBQUksRUFBRSxNQUFNO1lBQ1osR0FBRyxFQUFFLEdBQUc7WUFDUixXQUFXLEVBQUUsa0JBQWtCO1lBQy9CLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztZQUMxQixPQUFPLEVBQUU7Z0JBQ0wsMEJBQTBCLEVBQUUsTUFBTSxDQUFDLHdCQUF3QjthQUM5RDtTQUNKLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldENvb2tpZSB9IGZyb20gXCIuL2Nvb2tpZXMuanNcIlxyXG5cclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gICAgaW50ZXJmYWNlIFdpbmRvdyB7IFJlcXVlc3RWZXJpZmljYXRpb25Ub2tlbjogc3RyaW5nIH1cclxufVxyXG5cclxuZXhwb3J0IGVudW0gRmFybUFqYXhNZXNzYWdlVHlwZSB7XHJcbiAgICBOb25lLFxyXG4gICAgSW5mb3JtYXRpb24sXHJcbiAgICBXYXJuaW5nLFxyXG4gICAgRXJyb3JcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRmFybUFqYXhNZXNzYWdlRm9ybWF0IHtcclxuICAgIERlZmF1bHQsXHJcbiAgICBVbm9yZGVyZWRMaXN0XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZSB7XHJcbiAgICBtZXNzYWdlRm9ybWF0OiBGYXJtQWpheE1lc3NhZ2VGb3JtYXQ7XHJcbiAgICBtZXNzYWdlVHlwZTogRmFybUFqYXhNZXNzYWdlVHlwZTtcclxuICAgIG1lc3NhZ2U6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBGYXJtQWpheE1lc3NhZ2VUeXBlLCBtZXNzYWdlOiBzdHJpbmcsIGZvcm1hdDogRmFybUFqYXhNZXNzYWdlRm9ybWF0KSB7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlVHlwZSA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VGb3JtYXQgPSBmb3JtYXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHBvcHVsYXRlTWVzc2FnZUJveChib3g6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgYm94LmNsYXNzTGlzdC5yZW1vdmUoXCJpbmZvXCIsIFwiZXJyb3JcIiwgXCJ3YXJuaW5nXCIpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHRoaXMubWVzc2FnZVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBGYXJtQWpheE1lc3NhZ2VUeXBlLkVycm9yOlxyXG4gICAgICAgICAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBGYXJtQWpheE1lc3NhZ2VUeXBlLkluZm9ybWF0aW9uOlxyXG4gICAgICAgICAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoXCJpbmZvXCIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIEZhcm1BamF4TWVzc2FnZVR5cGUuV2FybmluZzpcclxuICAgICAgICAgICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKFwid2FybmluZ1wiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDogYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBib3guY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XHJcblxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5tZXNzYWdlRm9ybWF0KSB7XHJcbiAgICAgICAgICAgIGNhc2UgRmFybUFqYXhNZXNzYWdlRm9ybWF0LkRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBib3guaW5uZXJIVE1MID0gdGhpcy5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIEZhcm1BamF4TWVzc2FnZUZvcm1hdC5Vbm9yZGVyZWRMaXN0OlxyXG4gICAgICAgICAgICAgICAgYm94LmlubmVySFRNTCA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO1xyXG4gICAgICAgICAgICAgICAgYm94LmFwcGVuZENoaWxkKHVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpdGVtIG9mIHRoaXMubWVzc2FnZS5zcGxpdChcIlxcblwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBsaS5pbm5lclRleHQgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHVsLmFwcGVuZENoaWxkKGxpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDogYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmFybUFqYXhNZXNzYWdlQW5kVmFsdWVSZXNwb25zZTxUPiBleHRlbmRzIEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlIHtcclxuICAgIHB1YmxpYyB2YWx1ZTogVCB8IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogRmFybUFqYXhNZXNzYWdlUmVzcG9uc2UsIHZhbHVlOiBUIHwgbnVsbCkge1xyXG4gICAgICAgIHN1cGVyKG1lc3NhZ2UubWVzc2FnZVR5cGUsIG1lc3NhZ2UubWVzc2FnZSwgbWVzc2FnZS5tZXNzYWdlRm9ybWF0KTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGYXJtQWpheEdlbmVyaWNWYWx1ZTxUPiB7XHJcbiAgICBwdWJsaWMgdmFsdWU6IFQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IodmFsdWU6IFQpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGYXJtQWpheCB7XHJcbiAgICBzdGF0aWMgcG9zdFdpdGhNZXNzYWdlUmVzcG9uc2UodXJsOiBzdHJpbmcsIGRhdGE6IGFueSwgb25Eb25lOiAocmVzcG9uc2U6IEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgRmFybUFqYXhcclxuICAgICAgICAgICAgLmRvQWpheCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uIChyZXNwb25zZTogRmFybUFqYXhNZXNzYWdlUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIG9uRG9uZShuZXcgRmFybUFqYXhNZXNzYWdlUmVzcG9uc2UoXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZVR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlRm9ybWF0XHJcbiAgICAgICAgICAgICAgICApKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZhaWwoKGVycm9yKSA9PiBvbkRvbmUobmV3IEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlKFxyXG4gICAgICAgICAgICAgICAgRmFybUFqYXhNZXNzYWdlVHlwZS5FcnJvcixcclxuICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGVycm9yKSxcclxuICAgICAgICAgICAgICAgIEZhcm1BamF4TWVzc2FnZUZvcm1hdC5Vbm9yZGVyZWRMaXN0XHJcbiAgICAgICAgICAgICkpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcG9zdFdpdGhNZXNzYWdlQW5kVmFsdWVSZXNwb25zZTxUPih1cmw6IHN0cmluZywgZGF0YTogYW55LCBvbkRvbmU6IChyZXNwb25zZTogRmFybUFqYXhNZXNzYWdlQW5kVmFsdWVSZXNwb25zZTxUIHwgbnVsbD4pID0+IHZvaWQpIHtcclxuICAgICAgICBGYXJtQWpheFxyXG4gICAgICAgICAgICAuZG9BamF4KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlOiBGYXJtQWpheE1lc3NhZ2VBbmRWYWx1ZVJlc3BvbnNlPFQ+KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZShcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlVHlwZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2VGb3JtYXRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBvbkRvbmUobmV3IEZhcm1BamF4TWVzc2FnZUFuZFZhbHVlUmVzcG9uc2UobWVzc2FnZSwgcmVzcG9uc2UudmFsdWUpKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZhaWwoKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZShcclxuICAgICAgICAgICAgICAgICAgICBGYXJtQWpheE1lc3NhZ2VUeXBlLkVycm9yLFxyXG4gICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGVycm9yKSxcclxuICAgICAgICAgICAgICAgICAgICBGYXJtQWpheE1lc3NhZ2VGb3JtYXQuVW5vcmRlcmVkTGlzdFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIG9uRG9uZShuZXcgRmFybUFqYXhNZXNzYWdlQW5kVmFsdWVSZXNwb25zZShtZXNzYWdlLCBudWxsKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGRvQWpheCh1cmw6IHN0cmluZywgZGF0YTogYW55KTogSlF1ZXJ5LmpxWEhSIHtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbClcclxuICAgICAgICAgICAgZGF0YSA9IHt9O1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5TZXNzaW9uVG9rZW4gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgdGhyb3cgXCJQbGVhc2UgZG9uJ3QgZGVmaW5lIHlvdXIgb3duICdTZXNzaW9uVG9rZW4nIGZpZWxkLCBGYXJtQWpheCB3aWxsIGhhbmRsZSB0aGF0IGZvciB5b3UuXCI7XHJcblxyXG4gICAgICAgIGRhdGEuU2Vzc2lvblRva2VuID0gZ2V0Q29va2llKFwiRmFybU1hc3RlckF1dGhcIik7XHJcbiAgICAgICAgcmV0dXJuICQuYWpheCh7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIlJlcXVlc3RWZXJpZmljYXRpb25Ub2tlblwiOiB3aW5kb3cuUmVxdWVzdFZlcmlmaWNhdGlvblRva2VuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==