import { getCookie } from "./cookies.js";
export var FarmAjaxMessageType;
(function (FarmAjaxMessageType) {
    FarmAjaxMessageType[FarmAjaxMessageType["None"] = 0] = "None";
    FarmAjaxMessageType[FarmAjaxMessageType["Information"] = 1] = "Information";
    FarmAjaxMessageType[FarmAjaxMessageType["Warning"] = 2] = "Warning";
    FarmAjaxMessageType[FarmAjaxMessageType["Error"] = 3] = "Error";
})(FarmAjaxMessageType || (FarmAjaxMessageType = {}));
export var FarmAjaxMessageFormat;
(function (FarmAjaxMessageFormat) {
    FarmAjaxMessageFormat[FarmAjaxMessageFormat["Default"] = 0] = "Default";
    FarmAjaxMessageFormat[FarmAjaxMessageFormat["UnorderedList"] = 1] = "UnorderedList";
})(FarmAjaxMessageFormat || (FarmAjaxMessageFormat = {}));
export class FarmAjaxMessageResponse {
    constructor(type, message, format) {
        this.messageType = type;
        this.message = message;
        this.messageFormat = format;
    }
    populateMessageBox(box) {
        box.classList.remove("info", "error", "warning");
        switch (this.messageType) {
            case FarmAjaxMessageType.Error:
                box.classList.add("error");
                break;
            case FarmAjaxMessageType.Information:
                box.classList.add("info");
                break;
            case FarmAjaxMessageType.Warning:
                box.classList.add("warning");
                break;
            default: break;
        }
        box.classList.add("visible");
        switch (this.messageFormat) {
            case FarmAjaxMessageFormat.Default:
                box.innerHTML = this.message;
                break;
            case FarmAjaxMessageFormat.UnorderedList:
                box.innerHTML = "";
                let ul = document.createElement("ul");
                box.appendChild(ul);
                for (let item of this.message.split("\n")) {
                    let li = document.createElement("li");
                    li.innerText = item;
                    ul.appendChild(li);
                }
                break;
            default: break;
        }
    }
}
export class FarmAjaxMessageAndValueResponse extends FarmAjaxMessageResponse {
    constructor(message, value) {
        super(message.messageType, message.message, message.messageFormat);
        this.value = value;
    }
}
export class FarmAjaxGenericValue {
    constructor(value) {
        this.value = value;
    }
}
export class FarmAjax {
    static postWithMessageResponse(url, data, onDone) {
        FarmAjax
            .doAjax(url, data)
            .done(function (response) {
            onDone(new FarmAjaxMessageResponse(response.messageType, response.message, response.messageFormat));
        })
            .fail((error) => onDone(new FarmAjaxMessageResponse(FarmAjaxMessageType.Error, JSON.stringify(error), FarmAjaxMessageFormat.UnorderedList)));
    }
    static postWithMessageAndValueResponse(url, data, onDone) {
        FarmAjax
            .doAjax(url, data)
            .done(function (response) {
            let message = new FarmAjaxMessageResponse(response.messageType, response.message, response.messageFormat);
            onDone(new FarmAjaxMessageAndValueResponse(message, response.value));
        })
            .fail((error) => {
            let message = new FarmAjaxMessageResponse(FarmAjaxMessageType.Error, JSON.stringify(error), FarmAjaxMessageFormat.UnorderedList);
            onDone(new FarmAjaxMessageAndValueResponse(message, null));
        });
    }
    static doAjax(url, data) {
        if (data === null)
            data = {};
        if (data.SessionToken !== undefined)
            throw "Please don't define your own 'SessionToken' field, FarmAjax will handle that for you.";
        data.SessionToken = getCookie("FarmMasterAuth");
        return $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data)
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFybV9hamF4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vU2NyaXB0cy9mYXJtX2FqYXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUV4QyxNQUFNLENBQU4sSUFBWSxtQkFLWDtBQUxELFdBQVksbUJBQW1CO0lBQzNCLDZEQUFJLENBQUE7SUFDSiwyRUFBVyxDQUFBO0lBQ1gsbUVBQU8sQ0FBQTtJQUNQLCtEQUFLLENBQUE7QUFDVCxDQUFDLEVBTFcsbUJBQW1CLEtBQW5CLG1CQUFtQixRQUs5QjtBQUVELE1BQU0sQ0FBTixJQUFZLHFCQUdYO0FBSEQsV0FBWSxxQkFBcUI7SUFDN0IsdUVBQU8sQ0FBQTtJQUNQLG1GQUFhLENBQUE7QUFDakIsQ0FBQyxFQUhXLHFCQUFxQixLQUFyQixxQkFBcUIsUUFHaEM7QUFFRCxNQUFNLE9BQU8sdUJBQXVCO0lBS2hDLFlBQVksSUFBeUIsRUFBRSxPQUFlLEVBQUUsTUFBNkI7UUFDakYsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7SUFDaEMsQ0FBQztJQUVNLGtCQUFrQixDQUFDLEdBQWdCO1FBQ3RDLEdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFakQsUUFBUSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3RCLEtBQUssbUJBQW1CLENBQUMsS0FBSztnQkFDMUIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzNCLE1BQU07WUFFVixLQUFLLG1CQUFtQixDQUFDLFdBQVc7Z0JBQ2hDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dC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QUFDLEtBQUssRUFBRSxFQUFFO1lBQ1osSUFBSSxPQUFPLEdBQUcsSUFBSSx1QkFBdUIsQ0FDckMsbUJBQW1CLENBQUMsS0FBSyxFQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUNyQixxQkFBcUIsQ0FBQyxhQUFhLENBQ3RDLENBQUM7WUFDRixNQUFNLENBQUMsSUFBSSwrQkFBK0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQVcsRUFBRSxJQUFTO1FBQ3hDLElBQUksSUFBSSxLQUFLLElBQUk7WUFDYixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWQsSUFBSSxJQUFJLENBQUMsWUFBWSxLQUFLLFNBQVM7WUFDL0IsTUFBTSx1RkFBdUYsQ0FBQztRQUVsRyxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNWLElBQUksRUFBRSxNQUFNO1lBQ1osR0FBRyxFQUFFLEdBQUc7WUFDUixXQUFXLEVBQUUsa0JBQWtCO1lBQy9CLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztTQUM3QixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRDb29raWUgfSBmcm9tIFwiLi9jb29raWVzLmpzXCJcclxuXHJcbmV4cG9ydCBlbnVtIEZhcm1BamF4TWVzc2FnZVR5cGUge1xyXG4gICAgTm9uZSxcclxuICAgIEluZm9ybWF0aW9uLFxyXG4gICAgV2FybmluZyxcclxuICAgIEVycm9yXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEZhcm1BamF4TWVzc2FnZUZvcm1hdCB7XHJcbiAgICBEZWZhdWx0LFxyXG4gICAgVW5vcmRlcmVkTGlzdFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmFybUFqYXhNZXNzYWdlUmVzcG9uc2Uge1xyXG4gICAgbWVzc2FnZUZvcm1hdDogRmFybUFqYXhNZXNzYWdlRm9ybWF0O1xyXG4gICAgbWVzc2FnZVR5cGU6IEZhcm1BamF4TWVzc2FnZVR5cGU7XHJcbiAgICBtZXNzYWdlOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IodHlwZTogRmFybUFqYXhNZXNzYWdlVHlwZSwgbWVzc2FnZTogc3RyaW5nLCBmb3JtYXQ6IEZhcm1BamF4TWVzc2FnZUZvcm1hdCkge1xyXG4gICAgICAgIHRoaXMubWVzc2FnZVR5cGUgPSB0eXBlO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlRm9ybWF0ID0gZm9ybWF0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwb3B1bGF0ZU1lc3NhZ2VCb3goYm94OiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGJveC5jbGFzc0xpc3QucmVtb3ZlKFwiaW5mb1wiLCBcImVycm9yXCIsIFwid2FybmluZ1wiKTtcclxuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLm1lc3NhZ2VUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRmFybUFqYXhNZXNzYWdlVHlwZS5FcnJvcjpcclxuICAgICAgICAgICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKFwiZXJyb3JcIik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgRmFybUFqYXhNZXNzYWdlVHlwZS5JbmZvcm1hdGlvbjpcclxuICAgICAgICAgICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKFwiaW5mb1wiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBGYXJtQWpheE1lc3NhZ2VUeXBlLldhcm5pbmc6XHJcbiAgICAgICAgICAgICAgICBib3guY2xhc3NMaXN0LmFkZChcIndhcm5pbmdcIik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoXCJ2aXNpYmxlXCIpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHRoaXMubWVzc2FnZUZvcm1hdCkge1xyXG4gICAgICAgICAgICBjYXNlIEZhcm1BamF4TWVzc2FnZUZvcm1hdC5EZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYm94LmlubmVySFRNTCA9IHRoaXMubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBGYXJtQWpheE1lc3NhZ2VGb3JtYXQuVW5vcmRlcmVkTGlzdDpcclxuICAgICAgICAgICAgICAgIGJveC5pbm5lckhUTUwgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTtcclxuICAgICAgICAgICAgICAgIGJveC5hcHBlbmRDaGlsZCh1bCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLm1lc3NhZ2Uuc3BsaXQoXCJcXG5cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgbGkuaW5uZXJUZXh0ID0gaXRlbTtcclxuICAgICAgICAgICAgICAgICAgICB1bC5hcHBlbmRDaGlsZChsaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEZhcm1BamF4TWVzc2FnZUFuZFZhbHVlUmVzcG9uc2U8VD4gZXh0ZW5kcyBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZSB7XHJcbiAgICBwdWJsaWMgdmFsdWU6IFQgfCBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlLCB2YWx1ZTogVCB8IG51bGwpIHtcclxuICAgICAgICBzdXBlcihtZXNzYWdlLm1lc3NhZ2VUeXBlLCBtZXNzYWdlLm1lc3NhZ2UsIG1lc3NhZ2UubWVzc2FnZUZvcm1hdCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmFybUFqYXhHZW5lcmljVmFsdWU8VD4ge1xyXG4gICAgcHVibGljIHZhbHVlOiBUO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlOiBUKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmFybUFqYXgge1xyXG4gICAgc3RhdGljIHBvc3RXaXRoTWVzc2FnZVJlc3BvbnNlKHVybDogc3RyaW5nLCBkYXRhOiBhbnksIG9uRG9uZTogKHJlc3BvbnNlOiBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZSkgPT4gdm9pZCkge1xyXG4gICAgICAgIEZhcm1BamF4XHJcbiAgICAgICAgICAgIC5kb0FqYXgodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAocmVzcG9uc2U6IEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBvbkRvbmUobmV3IEZhcm1BamF4TWVzc2FnZVJlc3BvbnNlKFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2VUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZUZvcm1hdFxyXG4gICAgICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5mYWlsKChlcnJvcikgPT4gb25Eb25lKG5ldyBGYXJtQWpheE1lc3NhZ2VSZXNwb25zZShcclxuICAgICAgICAgICAgICAgIEZhcm1BamF4TWVzc2FnZVR5cGUuRXJyb3IsXHJcbiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShlcnJvciksXHJcbiAgICAgICAgICAgICAgICBGYXJtQWpheE1lc3NhZ2VGb3JtYXQuVW5vcmRlcmVkTGlzdFxyXG4gICAgICAgICAgICApKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHBvc3RXaXRoTWVzc2FnZUFuZFZhbHVlUmVzcG9uc2U8VD4odXJsOiBzdHJpbmcsIGRhdGE6IGFueSwgb25Eb25lOiAocmVzcG9uc2U6IEZhcm1BamF4TWVzc2FnZUFuZFZhbHVlUmVzcG9uc2U8VCB8IG51bGw+KSA9PiB2b2lkKSB7XHJcbiAgICAgICAgRmFybUFqYXhcclxuICAgICAgICAgICAgLmRvQWpheCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uIChyZXNwb25zZTogRmFybUFqYXhNZXNzYWdlQW5kVmFsdWVSZXNwb25zZTxUPikge1xyXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgRmFybUFqYXhNZXNzYWdlUmVzcG9uc2UoXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZVR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlRm9ybWF0XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgb25Eb25lKG5ldyBGYXJtQWpheE1lc3NhZ2VBbmRWYWx1ZVJlc3BvbnNlKG1lc3NhZ2UsIHJlc3BvbnNlLnZhbHVlKSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5mYWlsKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgRmFybUFqYXhNZXNzYWdlUmVzcG9uc2UoXHJcbiAgICAgICAgICAgICAgICAgICAgRmFybUFqYXhNZXNzYWdlVHlwZS5FcnJvcixcclxuICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShlcnJvciksXHJcbiAgICAgICAgICAgICAgICAgICAgRmFybUFqYXhNZXNzYWdlRm9ybWF0LlVub3JkZXJlZExpc3RcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBvbkRvbmUobmV3IEZhcm1BamF4TWVzc2FnZUFuZFZhbHVlUmVzcG9uc2UobWVzc2FnZSwgbnVsbCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBkb0FqYXgodXJsOiBzdHJpbmcsIGRhdGE6IGFueSk6IEpRdWVyeS5qcVhIUiB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IG51bGwpXHJcbiAgICAgICAgICAgIGRhdGEgPSB7fTtcclxuXHJcbiAgICAgICAgaWYgKGRhdGEuU2Vzc2lvblRva2VuICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRocm93IFwiUGxlYXNlIGRvbid0IGRlZmluZSB5b3VyIG93biAnU2Vzc2lvblRva2VuJyBmaWVsZCwgRmFybUFqYXggd2lsbCBoYW5kbGUgdGhhdCBmb3IgeW91LlwiO1xyXG5cclxuICAgICAgICBkYXRhLlNlc3Npb25Ub2tlbiA9IGdldENvb2tpZShcIkZhcm1NYXN0ZXJBdXRoXCIpO1xyXG4gICAgICAgIHJldHVybiAkLmFqYXgoe1xyXG4gICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19