import { GraphQL } from "./graphql.js";
export class Dropdown {
    constructor(dropdownNodeOrId) {
        if (dropdownNodeOrId instanceof HTMLDivElement)
            this.dropdownNode = dropdownNodeOrId;
        else
            this.dropdownNode = document.getElementById(dropdownNodeOrId);
        if (!this.dropdownNode)
            throw "The dropdown node is null. Parameter given was: " + dropdownNodeOrId;
        // For now, we only support Fomantic UI style, since I doubt it'll be replaced anytime soon.
        this.inputNode = this.dropdownNode.querySelector("div.dropdown input[type=hidden]");
        if (!this.inputNode)
            throw "Could not find the input element. Is your markup in Fomantic UI style?";
        this.menuNode = this.dropdownNode.querySelector("div.dropdown div.menu");
        if (!this.menuNode)
            throw "Could not find the menu element. Is your markup in Fomantic UI style?";
        this.defaultValue = this.inputNode.dataset.defaultValue;
        const refreshButton = this.dropdownNode.querySelector("label .button[data-type=refresh]");
        refreshButton.addEventListener("click", () => this.refresh());
        // Just to make sure Fomantic UI knows about it, saving the user the hassle.
        $(this.menuNode.parentNode).dropdown({ forceSelection: false });
        this._refreshFunc = function () { alert("No refresh function has been assigned."); };
    }
    // FUNCTIONS TO MANIPULATE ITEMS
    addItem(
    // Gotta love TS' syntax.
    { name, value = null, isSelected = false }) {
        const item = this.menuNode.appendChild(document.createElement("div"));
        item.classList.add("item");
        item.innerText = name;
        if (value)
            item.dataset.value = value;
        if (isSelected) {
            // Fomantic UI's own functions are too buggy to use, so we do things ourselves
            item.classList.add("active", "selected");
            this.inputNode.value = (!value) ? name : value;
            const textbox = this.dropdownNode.querySelector("div.dropdown div.text");
            textbox.innerText = name;
            this.inputNode.dispatchEvent(new Event("change"));
        }
        return item;
    }
    clear() {
        while (this.menuNode.firstChild)
            this.menuNode.removeChild(this.menuNode.firstChild);
        const textbox = this.dropdownNode.querySelector("div.dropdown div.text");
        textbox.innerText = "";
    }
    refresh() {
        this._refreshFunc();
    }
    // GENERIC DATA SOURCES
    fromRefreshFunc(func) {
        this._refreshFunc = func;
    }
    fromGraphQL({ query, parameters = null, dataGetter }) {
        this.fromRefreshFunc(() => {
            GraphQL
                .query(query, parameters)
                .then((data) => {
                this.clear();
                const nameValuePairs = dataGetter(data);
                for (const pair of nameValuePairs)
                    this.addItem({ name: pair.name, value: pair.value, isSelected: pair.value == this.defaultValue });
            })
                .catch((reason) => {
                alert("TEMP error handling: " + JSON.stringify(reason));
            });
        });
        this.refresh();
    }
    // COMMON DROPDOWN DATA SOURCES
    //
    // If the data source is used in more than one page, its probably best to put it here.
    fromNameIdGraphQL(entityName) {
        this.fromGraphQL({
            query: `query GetOwners {
                ${entityName} {
                    id
                    name
                }
            }`,
            dataGetter: (json) => json[entityName].map(function (v) {
                return { name: v.name, value: String(v.id) };
            })
        });
    }
    fromContactGraphQL() {
        this.fromNameIdGraphQL("contacts");
    }
    fromSpeciesGraphQL() {
        this.fromNameIdGraphQL("species");
    }
    fromHoldingGraphQL() {
        this.fromNameIdGraphQL("holdings");
    }
    fromAnimalGroupGraphQL() {
        this.fromNameIdGraphQL("animalGroups");
    }
    fromBreedGraphQL() {
        this.fromNameIdGraphQL("breeds");
    }
    fromLifeEventGraphQL() {
        this.fromNameIdGraphQL("lifeEvents");
    }
}
export default Dropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9TY3JpcHRzL2Ryb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFFdEMsTUFBTSxPQUFPLFFBQVE7SUFPakIsWUFBWSxnQkFBeUM7UUFDakQsSUFBSSxnQkFBZ0IsWUFBWSxjQUFjO1lBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUM7O1lBRXJDLElBQUksQ0FBQyxZQUFZLEdBQW1CLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUVsRixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVk7WUFDbEIsTUFBTSxrREFBa0QsR0FBRyxnQkFBZ0IsQ0FBQztRQUVoRiw0RkFBNEY7UUFDNUYsSUFBSSxDQUFDLFNBQVMsR0FBcUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUN0RyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7WUFDZixNQUFNLHdFQUF3RSxDQUFDO1FBRW5GLElBQUksQ0FBQyxRQUFRLEdBQW1CLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDekYsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQ2QsTUFBTSx1RUFBdUUsQ0FBQztRQUVsRixJQUFJLENBQUMsWUFBWSxHQUFXLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztRQUVoRSxNQUFNLGFBQWEsR0FBZ0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUN2RyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBRTlELDRFQUE0RTtRQUM1RSxDQUFDLENB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ImltcG9ydCB7IEdyYXBoUUwgfSBmcm9tIFwiLi9ncmFwaHFsLmpzXCJcclxuXHJcbmV4cG9ydCBjbGFzcyBEcm9wZG93biB7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgZHJvcGRvd25Ob2RlOiBIVE1MRGl2RWxlbWVudDtcclxuICAgIHB1YmxpYyByZWFkb25seSBpbnB1dE5vZGU6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgbWVudU5vZGU6IEhUTUxEaXZFbGVtZW50O1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGRlZmF1bHRWYWx1ZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfcmVmcmVzaEZ1bmM6IEZ1bmN0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGRyb3Bkb3duTm9kZU9ySWQ6IEhUTUxEaXZFbGVtZW50IHwgc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKGRyb3Bkb3duTm9kZU9ySWQgaW5zdGFuY2VvZiBIVE1MRGl2RWxlbWVudClcclxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bk5vZGUgPSBkcm9wZG93bk5vZGVPcklkO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bk5vZGUgPSA8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZHJvcGRvd25Ob2RlT3JJZCk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kcm9wZG93bk5vZGUpXHJcbiAgICAgICAgICAgIHRocm93IFwiVGhlIGRyb3Bkb3duIG5vZGUgaXMgbnVsbC4gUGFyYW1ldGVyIGdpdmVuIHdhczogXCIgKyBkcm9wZG93bk5vZGVPcklkO1xyXG5cclxuICAgICAgICAvLyBGb3Igbm93LCB3ZSBvbmx5IHN1cHBvcnQgRm9tYW50aWMgVUkgc3R5bGUsIHNpbmNlIEkgZG91YnQgaXQnbGwgYmUgcmVwbGFjZWQgYW55dGltZSBzb29uLlxyXG4gICAgICAgIHRoaXMuaW5wdXROb2RlID0gPEhUTUxJbnB1dEVsZW1lbnQ+dGhpcy5kcm9wZG93bk5vZGUucXVlcnlTZWxlY3RvcihcImRpdi5kcm9wZG93biBpbnB1dFt0eXBlPWhpZGRlbl1cIik7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlucHV0Tm9kZSlcclxuICAgICAgICAgICAgdGhyb3cgXCJDb3VsZCBub3QgZmluZCB0aGUgaW5wdXQgZWxlbWVudC4gSXMgeW91ciBtYXJrdXAgaW4gRm9tYW50aWMgVUkgc3R5bGU/XCI7XHJcblxyXG4gICAgICAgIHRoaXMubWVudU5vZGUgPSA8SFRNTERpdkVsZW1lbnQ+dGhpcy5kcm9wZG93bk5vZGUucXVlcnlTZWxlY3RvcihcImRpdi5kcm9wZG93biBkaXYubWVudVwiKTtcclxuICAgICAgICBpZiAoIXRoaXMubWVudU5vZGUpXHJcbiAgICAgICAgICAgIHRocm93IFwiQ291bGQgbm90IGZpbmQgdGhlIG1lbnUgZWxlbWVudC4gSXMgeW91ciBtYXJrdXAgaW4gRm9tYW50aWMgVUkgc3R5bGU/XCI7XHJcblxyXG4gICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gPHN0cmluZz50aGlzLmlucHV0Tm9kZS5kYXRhc2V0LmRlZmF1bHRWYWx1ZTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVmcmVzaEJ1dHRvbiA9IDxIVE1MRWxlbWVudD50aGlzLmRyb3Bkb3duTm9kZS5xdWVyeVNlbGVjdG9yKFwibGFiZWwgLmJ1dHRvbltkYXRhLXR5cGU9cmVmcmVzaF1cIik7XHJcbiAgICAgICAgcmVmcmVzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5yZWZyZXNoKCkpO1xyXG5cclxuICAgICAgICAvLyBKdXN0IHRvIG1ha2Ugc3VyZSBGb21hbnRpYyBVSSBrbm93cyBhYm91dCBpdCwgc2F2aW5nIHRoZSB1c2VyIHRoZSBoYXNzbGUuXHJcbiAgICAgICAgJCg8YW55PnRoaXMubWVudU5vZGUucGFyZW50Tm9kZSkuZHJvcGRvd24oeyBmb3JjZVNlbGVjdGlvbjogZmFsc2UgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuX3JlZnJlc2hGdW5jID0gZnVuY3Rpb24gKCkgeyBhbGVydChcIk5vIHJlZnJlc2ggZnVuY3Rpb24gaGFzIGJlZW4gYXNzaWduZWQuXCIpOyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZVTkNUSU9OUyBUTyBNQU5JUFVMQVRFIElURU1TXHJcblxyXG4gICAgcHVibGljIGFkZEl0ZW0oXHJcbiAgICAgICAgLy8gR290dGEgbG92ZSBUUycgc3ludGF4LlxyXG4gICAgICAgIHsgbmFtZSwgICAgICAgICB2YWx1ZSA9IG51bGwsICAgICAgICAgIGlzU2VsZWN0ZWQgPSBmYWxzZSB9OlxyXG4gICAgICAgIHsgbmFtZTogc3RyaW5nLCB2YWx1ZT86IHN0cmluZyB8IG51bGwsIGlzU2VsZWN0ZWQ6IGJvb2xlYW4gfVxyXG4gICAgKTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLm1lbnVOb2RlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcIml0ZW1cIik7XHJcbiAgICAgICAgaXRlbS5pbm5lclRleHQgPSBuYW1lO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUpXHJcbiAgICAgICAgICAgIGl0ZW0uZGF0YXNldC52YWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgICBpZiAoaXNTZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAvLyBGb21hbnRpYyBVSSdzIG93biBmdW5jdGlvbnMgYXJlIHRvbyBidWdneSB0byB1c2UsIHNvIHdlIGRvIHRoaW5ncyBvdXJzZWx2ZXNcclxuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIsIFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXROb2RlLnZhbHVlID0gKCF2YWx1ZSkgPyBuYW1lIDogdmFsdWU7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0ZXh0Ym94ID0gPEhUTUxEaXZFbGVtZW50PnRoaXMuZHJvcGRvd25Ob2RlLnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZHJvcGRvd24gZGl2LnRleHRcIik7XHJcbiAgICAgICAgICAgIHRleHRib3guaW5uZXJUZXh0ID0gbmFtZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXROb2RlLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiY2hhbmdlXCIpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGVhcigpIHtcclxuICAgICAgICB3aGlsZSAodGhpcy5tZW51Tm9kZS5maXJzdENoaWxkKVxyXG4gICAgICAgICAgICB0aGlzLm1lbnVOb2RlLnJlbW92ZUNoaWxkKHRoaXMubWVudU5vZGUuZmlyc3RDaGlsZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRib3ggPSA8SFRNTERpdkVsZW1lbnQ+dGhpcy5kcm9wZG93bk5vZGUucXVlcnlTZWxlY3RvcihcImRpdi5kcm9wZG93biBkaXYudGV4dFwiKTtcclxuICAgICAgICB0ZXh0Ym94LmlubmVyVGV4dCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlZnJlc2goKSB7XHJcbiAgICAgICAgdGhpcy5fcmVmcmVzaEZ1bmMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHRU5FUklDIERBVEEgU09VUkNFU1xyXG5cclxuICAgIHB1YmxpYyBmcm9tUmVmcmVzaEZ1bmMoZnVuYzogRnVuY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9yZWZyZXNoRnVuYyA9IGZ1bmM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZyb21HcmFwaFFMKFxyXG4gICAgICAgIHsgcXVlcnksICAgICAgICAgcGFyYW1ldGVycyA9IG51bGwsICAgICAgICAgIGRhdGFHZXR0ZXIgfTpcclxuICAgICAgICB7IHF1ZXJ5OiBzdHJpbmcsIHBhcmFtZXRlcnM/OiBvYmplY3QgfCBudWxsLCBkYXRhR2V0dGVyOiAoZGF0YTogYW55KSA9PiB7IG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9W10gfVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tUmVmcmVzaEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICBHcmFwaFFMXHJcbiAgICAgICAgICAgICAgICAucXVlcnkocXVlcnksIHBhcmFtZXRlcnMpXHJcbiAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZVZhbHVlUGFpcnMgPSBkYXRhR2V0dGVyKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGFpciBvZiBuYW1lVmFsdWVQYWlycylcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRJdGVtKHsgbmFtZTogcGFpci5uYW1lLCB2YWx1ZTogcGFpci52YWx1ZSwgaXNTZWxlY3RlZDogcGFpci52YWx1ZSA9PSB0aGlzLmRlZmF1bHRWYWx1ZSB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiVEVNUCBlcnJvciBoYW5kbGluZzogXCIgKyBKU09OLnN0cmluZ2lmeShyZWFzb24pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENPTU1PTiBEUk9QRE9XTiBEQVRBIFNPVVJDRVNcclxuICAgIC8vXHJcbiAgICAvLyBJZiB0aGUgZGF0YSBzb3VyY2UgaXMgdXNlZCBpbiBtb3JlIHRoYW4gb25lIHBhZ2UsIGl0cyBwcm9iYWJseSBiZXN0IHRvIHB1dCBpdCBoZXJlLlxyXG5cclxuICAgIHByaXZhdGUgZnJvbU5hbWVJZEdyYXBoUUwoZW50aXR5TmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tR3JhcGhRTCh7XHJcbiAgICAgICAgICAgIHF1ZXJ5OiBgcXVlcnkgR2V0T3duZXJzIHtcclxuICAgICAgICAgICAgICAgICR7ZW50aXR5TmFtZX0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9YCxcclxuXHJcbiAgICAgICAgICAgIGRhdGFHZXR0ZXI6IChqc29uOiBhbnkpID0+IGpzb25bZW50aXR5TmFtZV0ubWFwKGZ1bmN0aW9uICh2OiB7IG5hbWU6IHN0cmluZywgaWQ6IHN0cmluZyB9KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyBuYW1lOiB2Lm5hbWUsIHZhbHVlOiBTdHJpbmcodi5pZCkgfTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZnJvbUNvbnRhY3RHcmFwaFFMKCkge1xyXG4gICAgICAgIHRoaXMuZnJvbU5hbWVJZEdyYXBoUUwoXCJjb250YWN0c1wiKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZnJvbVNwZWNpZXNHcmFwaFFMKCkge1xyXG4gICAgICAgIHRoaXMuZnJvbU5hbWVJZEdyYXBoUUwoXCJzcGVjaWVzXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmcm9tSG9sZGluZ0dyYXBoUUwoKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tTmFtZUlkR3JhcGhRTChcImhvbGRpbmdzXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmcm9tQW5pbWFsR3JvdXBHcmFwaFFMKCkge1xyXG4gICAgICAgIHRoaXMuZnJvbU5hbWVJZEdyYXBoUUwoXCJhbmltYWxHcm91cHNcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZyb21CcmVlZEdyYXBoUUwoKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tTmFtZUlkR3JhcGhRTChcImJyZWVkc1wiKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZnJvbUxpZmVFdmVudEdyYXBoUUwoKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tTmFtZUlkR3JhcGhRTChcImxpZmVFdmVudHNcIik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IERyb3Bkb3duOyJdfQ==