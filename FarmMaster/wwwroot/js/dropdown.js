import { GraphQL } from "./graphql.js";
export class Dropdown {
    constructor(dropdownNodeOrId) {
        if (dropdownNodeOrId instanceof HTMLDivElement)
            this.dropdownNode = dropdownNodeOrId;
        else
            this.dropdownNode = document.getElementById(dropdownNodeOrId);
        if (!this.dropdownNode)
            throw "The dropdown node is null. Parameter given was: " + dropdownNodeOrId;
        // For now, we only support Fomantic UI style, since I doubt it'll be replaced anytime soon.
        this.inputNode = this.dropdownNode.querySelector("div.dropdown input[type=hidden]");
        if (!this.inputNode)
            throw "Could not find the input element. Is your markup in Fomantic UI style?";
        this.menuNode = this.dropdownNode.querySelector("div.dropdown div.menu");
        if (!this.menuNode)
            throw "Could not find the menu element. Is your markup in Fomantic UI style?";
        this.defaultValue = this.inputNode.dataset.defaultValue;
        const refreshButton = this.dropdownNode.querySelector("label .button[data-type=refresh]");
        refreshButton.addEventListener("click", () => this.refresh());
        // Just to make sure Fomantic UI knows about it, saving the user the hassle.
        $(this.menuNode.parentNode).dropdown();
        this._refreshFunc = function () { alert("No refresh function has been assigned."); };
    }
    addItem(
    // Gotta love TS' syntax.
    { name, value = null, isSelected = false }) {
        const item = this.menuNode.appendChild(document.createElement("div"));
        item.classList.add("item");
        item.innerText = name;
        if (value)
            item.dataset.value = value;
        if (isSelected)
            $(this.menuNode.parentNode).dropdown("set selected", value || name);
        return item;
    }
    clear() {
        while (this.menuNode.firstChild)
            this.menuNode.removeChild(this.menuNode.firstChild);
    }
    refresh() {
        this._refreshFunc();
    }
    fromRefreshFunc(func) {
        this._refreshFunc = func;
    }
    fromGraphQL({ query, parameters = null, dataGetter }) {
        this.fromRefreshFunc(() => {
            GraphQL
                .query(query, parameters)
                .then((data) => {
                this.clear();
                const nameValuePairs = dataGetter(data);
                for (const pair of nameValuePairs)
                    this.addItem({ name: pair.name, value: pair.value, isSelected: pair.value == this.defaultValue });
            })
                .catch((reason) => {
                alert("TEMP error handling: " + JSON.stringify(reason));
            });
        });
        this.refresh();
        this.refresh(); // Very weird bug where, during the first refresh, Fomantic UI won't perform "set selected" correctly.
    }
}
export default Dropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9TY3JpcHRzL2Ryb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFFdEMsTUFBTSxPQUFPLFFBQVE7SUFPakIsWUFBWSxnQkFBeUM7UUFDakQsSUFBSSxnQkFBZ0IsWUFBWSxjQUFjO1lBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUM7O1lBRXJDLElBQUksQ0FBQyxZQUFZLEdBQW1CLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUVsRixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVk7WUFDbEIsTUFBTSxrREFBa0QsR0FBRyxnQkFBZ0IsQ0FBQztRQUVoRiw0RkFBNEY7UUFDNUYsSUFBSSxDQUFDLFNBQVMsR0FBcUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUN0RyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7WUFDZixNQUFNLHdFQUF3RSxDQUFDO1FBRW5GLElBQUksQ0FBQyxRQUFRLEdBQW1CLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDekYsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQ2QsTUFBTSx1RUFBdUUsQ0FBQztRQUVsRixJQUFJLENBQUMsWUFBWSxHQUFXLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztRQUVoRSxNQUFNLGFBQWEsR0FBZ0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUN2RyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBRTlELDRFQUE0RTtRQUM1RSxDQUFDLENBQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUU1QyxJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekYsQ0FBQztJQUVNLE9BQU87SUFDVix5QkFBeUI7SUFDekIsRUFBRSxJQUFJLEVBQVUsS0FBSyxHQUFHLElBQUksRUFBVyxVQUFVLEdBQUcsS0FBSyxFQUNHO1FBRTVELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN0RSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUV0QixJQUFJLEtBQUs7WUFDTCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFFL0IsSUFBSSxVQUFVO1lBQ1YsQ0FBQyxDQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxLQUFLLElBQUksSUFBSSxDQUFDLENBQUM7UUFFN0UsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVNLEtBQUs7UUFDUixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTtZQUMzQixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFTSxPQUFPO1FBQ1YsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFTSxlQUFlLENBQUMsSUFBYztRQUNqQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRU0sV0FBVyxDQUNkLEVBQUUsS0FBSyxFQUFVLFVBQVUsR0FBRyxJQUFJLEVBQVcsVUFBVSxFQUN1RDtRQUU5RyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRTtZQUN0QixPQUFPO2lCQUNGLEtBQUssQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDO2lCQUN4QixJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDWCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBRWIsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN4QyxLQUFLLE1BQU0sSUFBSSxJQUFJLGNBQWM7b0JBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztZQUMxRyxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7Z0JBQ2QsS0FBSyxDQUFDLHVCQUF1QixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM1RCxDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsc0dBQXNHO0lBQzFILENBQUM7Q0FDSjtBQUVELGVBQWUsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JhcGhRTCB9IGZyb20gXCIuL2dyYXBocWwuanNcIlxyXG5cclxuZXhwb3J0IGNsYXNzIERyb3Bkb3duIHtcclxuICAgIHB1YmxpYyByZWFkb25seSBkcm9wZG93bk5vZGU6IEhUTUxEaXZFbGVtZW50O1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGlucHV0Tm9kZTogSFRNTElucHV0RWxlbWVudDtcclxuICAgIHB1YmxpYyByZWFkb25seSBtZW51Tm9kZTogSFRNTERpdkVsZW1lbnQ7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgZGVmYXVsdFZhbHVlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9yZWZyZXNoRnVuYzogRnVuY3Rpb247XHJcblxyXG4gICAgY29uc3RydWN0b3IoZHJvcGRvd25Ob2RlT3JJZDogSFRNTERpdkVsZW1lbnQgfCBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoZHJvcGRvd25Ob2RlT3JJZCBpbnN0YW5jZW9mIEhUTUxEaXZFbGVtZW50KVxyXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duTm9kZSA9IGRyb3Bkb3duTm9kZU9ySWQ7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duTm9kZSA9IDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChkcm9wZG93bk5vZGVPcklkKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRyb3Bkb3duTm9kZSlcclxuICAgICAgICAgICAgdGhyb3cgXCJUaGUgZHJvcGRvd24gbm9kZSBpcyBudWxsLiBQYXJhbWV0ZXIgZ2l2ZW4gd2FzOiBcIiArIGRyb3Bkb3duTm9kZU9ySWQ7XHJcblxyXG4gICAgICAgIC8vIEZvciBub3csIHdlIG9ubHkgc3VwcG9ydCBGb21hbnRpYyBVSSBzdHlsZSwgc2luY2UgSSBkb3VidCBpdCdsbCBiZSByZXBsYWNlZCBhbnl0aW1lIHNvb24uXHJcbiAgICAgICAgdGhpcy5pbnB1dE5vZGUgPSA8SFRNTElucHV0RWxlbWVudD50aGlzLmRyb3Bkb3duTm9kZS5xdWVyeVNlbGVjdG9yKFwiZGl2LmRyb3Bkb3duIGlucHV0W3R5cGU9aGlkZGVuXVwiKTtcclxuICAgICAgICBpZiAoIXRoaXMuaW5wdXROb2RlKVxyXG4gICAgICAgICAgICB0aHJvdyBcIkNvdWxkIG5vdCBmaW5kIHRoZSBpbnB1dCBlbGVtZW50LiBJcyB5b3VyIG1hcmt1cCBpbiBGb21hbnRpYyBVSSBzdHlsZT9cIjtcclxuXHJcbiAgICAgICAgdGhpcy5tZW51Tm9kZSA9IDxIVE1MRGl2RWxlbWVudD50aGlzLmRyb3Bkb3duTm9kZS5xdWVyeVNlbGVjdG9yKFwiZGl2LmRyb3Bkb3duIGRpdi5tZW51XCIpO1xyXG4gICAgICAgIGlmICghdGhpcy5tZW51Tm9kZSlcclxuICAgICAgICAgICAgdGhyb3cgXCJDb3VsZCBub3QgZmluZCB0aGUgbWVudSBlbGVtZW50LiBJcyB5b3VyIG1hcmt1cCBpbiBGb21hbnRpYyBVSSBzdHlsZT9cIjtcclxuXHJcbiAgICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSA8c3RyaW5nPnRoaXMuaW5wdXROb2RlLmRhdGFzZXQuZGVmYXVsdFZhbHVlO1xyXG5cclxuICAgICAgICBjb25zdCByZWZyZXNoQnV0dG9uID0gPEhUTUxFbGVtZW50PnRoaXMuZHJvcGRvd25Ob2RlLnF1ZXJ5U2VsZWN0b3IoXCJsYWJlbCAuYnV0dG9uW2RhdGEtdHlwZT1yZWZyZXNoXVwiKTtcclxuICAgICAgICByZWZyZXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLnJlZnJlc2goKSk7XHJcblxyXG4gICAgICAgIC8vIEp1c3QgdG8gbWFrZSBzdXJlIEZvbWFudGljIFVJIGtub3dzIGFib3V0IGl0LCBzYXZpbmcgdGhlIHVzZXIgdGhlIGhhc3NsZS5cclxuICAgICAgICAkKDxhbnk+dGhpcy5tZW51Tm9kZS5wYXJlbnROb2RlKS5kcm9wZG93bigpO1xyXG5cclxuICAgICAgICB0aGlzLl9yZWZyZXNoRnVuYyA9IGZ1bmN0aW9uICgpIHsgYWxlcnQoXCJObyByZWZyZXNoIGZ1bmN0aW9uIGhhcyBiZWVuIGFzc2lnbmVkLlwiKTsgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkSXRlbShcclxuICAgICAgICAvLyBHb3R0YSBsb3ZlIFRTJyBzeW50YXguXHJcbiAgICAgICAgeyBuYW1lLCAgICAgICAgIHZhbHVlID0gbnVsbCwgICAgICAgICAgaXNTZWxlY3RlZCA9IGZhbHNlIH06XHJcbiAgICAgICAgeyBuYW1lOiBzdHJpbmcsIHZhbHVlPzogc3RyaW5nIHwgbnVsbCwgaXNTZWxlY3RlZDogYm9vbGVhbiB9XHJcbiAgICApOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMubWVudU5vZGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7XHJcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKFwiaXRlbVwiKTtcclxuICAgICAgICBpdGVtLmlubmVyVGV4dCA9IG5hbWU7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZSlcclxuICAgICAgICAgICAgaXRlbS5kYXRhc2V0LnZhbHVlID0gdmFsdWU7XHJcblxyXG4gICAgICAgIGlmIChpc1NlbGVjdGVkKVxyXG4gICAgICAgICAgICAkKDxhbnk+dGhpcy5tZW51Tm9kZS5wYXJlbnROb2RlKS5kcm9wZG93bihcInNldCBzZWxlY3RlZFwiLCB2YWx1ZSB8fCBuYW1lKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsZWFyKCkge1xyXG4gICAgICAgIHdoaWxlICh0aGlzLm1lbnVOb2RlLmZpcnN0Q2hpbGQpXHJcbiAgICAgICAgICAgIHRoaXMubWVudU5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tZW51Tm9kZS5maXJzdENoaWxkKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVmcmVzaCgpIHtcclxuICAgICAgICB0aGlzLl9yZWZyZXNoRnVuYygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmcm9tUmVmcmVzaEZ1bmMoZnVuYzogRnVuY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9yZWZyZXNoRnVuYyA9IGZ1bmM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZyb21HcmFwaFFMKFxyXG4gICAgICAgIHsgcXVlcnksICAgICAgICAgcGFyYW1ldGVycyA9IG51bGwsICAgICAgICAgIGRhdGFHZXR0ZXIgfTpcclxuICAgICAgICB7IHF1ZXJ5OiBzdHJpbmcsIHBhcmFtZXRlcnM/OiBvYmplY3QgfCBudWxsLCBkYXRhR2V0dGVyOiAoZGF0YTogb2JqZWN0KSA9PiB7IG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9W10gfVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5mcm9tUmVmcmVzaEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICBHcmFwaFFMXHJcbiAgICAgICAgICAgICAgICAucXVlcnkocXVlcnksIHBhcmFtZXRlcnMpXHJcbiAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZVZhbHVlUGFpcnMgPSBkYXRhR2V0dGVyKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGFpciBvZiBuYW1lVmFsdWVQYWlycylcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRJdGVtKHsgbmFtZTogcGFpci5uYW1lLCB2YWx1ZTogcGFpci52YWx1ZSwgaXNTZWxlY3RlZDogcGFpci52YWx1ZSA9PSB0aGlzLmRlZmF1bHRWYWx1ZSB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiVEVNUCBlcnJvciBoYW5kbGluZzogXCIgKyBKU09OLnN0cmluZ2lmeShyZWFzb24pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaCgpOyAvLyBWZXJ5IHdlaXJkIGJ1ZyB3aGVyZSwgZHVyaW5nIHRoZSBmaXJzdCByZWZyZXNoLCBGb21hbnRpYyBVSSB3b24ndCBwZXJmb3JtIFwic2V0IHNlbGVjdGVkXCIgY29ycmVjdGx5LlxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBEcm9wZG93bjsiXX0=