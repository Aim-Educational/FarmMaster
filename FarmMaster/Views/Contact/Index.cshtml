@model ContactIndexViewModel
@{
    Layout = "_GenericEditorLayout";
    ViewData["Title"] = "Contacts";
    ViewData["Breadcrumb"] = new Dictionary<string, string>
    {
        { "Home", "/Home/Index" },
        { "Contacts", "/Contact/Index" }
    };
}

<section id="modalReason" class="ui modal">
    <section class="content">
        <section class="ui visible warning message">
            <p class="ui header">Warning!</p>
            <p>
                Accessing the contact information of a user or individual will fire off an email alerting them to
                your action. This is to deter people from mis-using their permissions to view data they shouldn't.
            </p>
        </section>
        <h4>Reason</h4>
        <div class="ui labeled fluid input">
            <input id="txtReasonForEdit" placeholder="Reason for edit" />
            <div class="ui corner label">
                <i class="asterisk icon"></i>
            </div>
        </div>
    </section>
    <section class="actions">
        <div class="ui black deny button">
            Cancel
        </div>
        <div class="ui positive button">
            Continue
        </div>
    </section>
</section>

<section id="modalConfirm" class="ui modal">
    <section class="content">
        <section class="ui visible error message">
            <p class="ui header">Are you sure?</p>
            <p>
                This action cannot be undone. Are you sure you want to delete this contact?
            </p>
        </section>
    </section>
    <section class="actions">
        <div class="ui black deny button">
            Cancel
        </div>
        <div class="ui positive button">
            Continue
        </div>
    </section>
</section>

<section class="editor section">
    <section>
        <partial name="_ViewModelWithMessagePartial" model="@Model" />

        <div class="content">
            <div class="top padded items">
                <a class="ui primary button" asp-action="Create">
                    Create New Contact
                </a>
            </div>

            <table id="tableIndex" class="ui striped table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <partial name="_IndexTableBodyPartial" model="Model.Contacts.Take(GlobalConstants.DefaultPageItemCount)" />
                </tbody>
                <tfoot>

                </tfoot>
            </table>
        </div>

        <section id="boxError" class="ui error message transition hidden">
        </section>
    </section>
</section>

@section Scripts {
    <script type="module">
        import { ComponentTable } from "/js/index.js"

        function showEditModal(contactId) {
            $("#modalReason")
                .modal({
                    onApprove: function () {
                        let reasonForEdit = document.querySelector("#txtReasonForEdit").value;
                        window.location = "/Contact/Edit/" + contactId + "?reason=" + reasonForEdit;
                    }
                })
                .modal('show');
        }
        window.showEditModal = showEditModal;

        function showDeleteModal(contactId) {
            $("#modalConfirm")
                .modal({
                    onApprove: function () {
                        window.location = "/Contact/Delete/" + contactId;
                    }
                })
                .modal('show');
        }
        window.showDeleteModal = showDeleteModal;

        ComponentTable.setupPagingTable(
            document.getElementById("boxError"),
            document.getElementById("tableIndex"),
            "/Contact/AjaxGetTablePageCount",
            "/Contact/AjaxRenderTablePage"
        );
    </script>
}