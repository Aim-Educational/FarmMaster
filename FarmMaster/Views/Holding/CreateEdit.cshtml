@model HoldingCreateEditViewModel
@{
    Layout = "_GenericEditorLayout";
    ViewData["Title"] = Model.IsCreate ? "Create Holding" : "Edit Holding";
    ViewData["Breadcrumb"] = new Dictionary<string, string>
    {
        { "Home", "/Home/Index"},
        { "Holdings", "/Holding/Index"},
        { $"{(Model.IsCreate ? "Create" : "Edit")}", "#" }
    };
}

<partial name="_ViewModelWithMessagePartial" model="@Model" />

<div id="modalRegHelp" class="ui modal">
    <div class="content">
        <div class="ui visible info message">
            <h3>What are these things?</h3>
            <p>Farms have to be registered to ...</p>
            <p>Herd numbers are...</p>
            <p>Rare breed numbers are...</p>
            <p>You can usually find these by...</p>
        </div>
    </div>
    <div class="actions">
        <div class="ui primary cancel button">
            Ok
        </div>
    </div>
</div>

<section class="editor section">
    <form class="ui form" asp-action="@(Model.IsCreate ? "Create" : "Edit")" asp-route-id="@(Model.IsCreate ? -1 : Model.Holding.HoldingId)">
        @if (!Model.IsCreate)
        {
            <input type="hidden" asp-for="Holding.Timestamp" />
            <input type="hidden" asp-for="Holding.HoldingId" />
        }
        <section>
            <h4>Information</h4>
            <div class="content">
                <div class="field">
                    <label>Name</label>
                    <input asp-for="Holding.Name" />
                </div>
                <div class="field">
                    <label>Holding Number</label>
                    <input asp-for="Holding.HoldingNumber" />
                </div>
                <div class="field">
                    <label>Grid Reference</label>
                    <input asp-for="Holding.GridReference" />
                </div>
                <div class="field">
                    <label>Address</label>
                    <input asp-for="Holding.Address" />
                </div>
                <div class="field">
                    <label>Postcode</label>
                    <input asp-for="Holding.Postcode" />
                </div>
                <vc:dropdown
                    label="Owner"
                    asp-for="Holding.OwnerContactId"
                    default-value="@(Convert.ToString(Model.Holding == null ? -1 : Model.Holding.HoldingId))"
                    dropdown-id="selectOwner"
                    goto-action="Index"
                    goto-controller="Contact"
                />
            </div>
        </section>
        <section>
            <div class="header with question">
                <h4>Registered for</h4>
                <button type="button" onclick="showRegistrationHelp()">?</button>
            </div>
            <div class="content">
                @foreach (var reg in Model.AllRegistrations)
                {
                    <div class="dark striped sub content">
                        <div class="holding registration">
                            <div class="field">
                                <div class="ui toggle checkbox">
                                    <input type="checkbox" asp-for="SelectedRegistrations[reg.InternalName]" />
                                    <label>@reg.Description</label>
                                </div>
                            </div>
                            <div class="field">
                                <input type="text" asp-for="SelectedRegistrationHerdNumbers[reg.InternalName]" placeholder="Herd Number" />
                            </div>
                            <div class="field">
                                <input type="text" asp-for="SelectedRegistrationsRareBreedNumbers[reg.InternalName]" placeholder="Rare Breed Number" />
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>
        <section>
            <div class="content">
                <div class="top padded items">
                    <button type="submit" class="ui fluid primary button">
                        @(Model.IsCreate ? "Create Holding" : "Edit Holding")
                    </button>
                </div>
                <div asp-validation-summary="All"></div>
            </div>
        </section>
    </form>
</section>

@section Scripts {
    <script type="module">
        import { Dropdown, Validation, Modal } from "/js/index.js"

        $(".ui.checkbox").checkbox();

        Validation.hookupForm(document.querySelector(".ui.form"));

        const selectOwner = new Dropdown("selectOwner");
        selectOwner.fromContactGraphQL();

        function showRegistrationHelp() {
            Modal.show("modalRegHelp");
        }
        window.showRegistrationHelp = showRegistrationHelp;
    </script>
}